---
title: ldap环境搭建
date: 2025-07-23 17:27:16
permalink: /pages/56a89f/
categories:
  - 持续集成
  - ldap教程
tags:
  - LDAP
  - OpenLDAP
  - Docker
author: 
  name: bingxueyizu
  link: https://github.com/bingxueyizu
---

## 简介

在企业内部系统中，LDAP（Lightweight Directory Access Protocol，轻量级目录访问协议）被广泛用于实现统一身份认证和用户信息管理。通过构建 LDAP 服务，可以统一管理用户账户、部门信息以及访问权限，并提供集中化的用户认证服务。

本文将介绍如何通过 Docker 快速搭建一套可视化、可自助修改密码的 LDAP 环境，适合用于测试、开发或企业内网部署使用。

---

## LDAP 基本概念

LDAP 是一种用于访问和管理分布式目录信息服务的协议，它以树状结构组织数据，类似于文件系统。

### 常用术语说明

| 关键字 | 全称 | 含义 |
|--------|------|------|
| **dn** | Distinguished Name | 条目的唯一标识，类似主键，例如：`uid=cs01,ou=users,dc=demo,dc=com` |
| **uid** | User ID | 用户登录名，例如 `cs01` |
| **cn** | Common Name | 通用名称，用户时可用于显示名，组时为组名 |
| **sn** | Surname | 用户的姓氏，LDAP 必填字段之一 |
| **ou** | Organizational Unit | 组织单位，例如 `users`、`departments` |
| **dc** | Domain Component | 域组件，如 `dc=demo,dc=com` 表示 `demo.com` |
| **mail** | 邮箱地址 | 用户邮箱地址 |
| **userPassword** | 密码 | 存储用户密码（通常为加密格式） |

---

## 常用对象类型说明

| 类型 | 描述 |
|------|------|
| `inetOrgPerson` | 最常用的用户对象类型，支持邮件、电话、地址等属性 |
| `organizationalUnit` | 组织单位类型，如部门 |
| `groupOfNames` | 组对象，可包含多个成员 DN |

---

## 使用 Docker 搭建 LDAP 服务

我们使用三大组件构建完整 LDAP 管理环境：

1. **OpenLDAP**：核心 LDAP 服务；
2. **phpLDAPadmin**：LDAP 可视化管理工具；
3. **Self-Service Password**：用户自助密码修改平台。

### 服务与镜像说明

| 镜像名称 | 用途 | 说明 |
|----------|------|------|
| `osixia/openldap:1.5.0` | OpenLDAP 主服务 | 提供 LDAP 协议服务 |
| `osixia/phpldapadmin:0.9.0` | 可视化管理界面 | 管理用户/组织等数据 |
| `tiredofit/self-service-password:5.3.1` | 密码修改工具 | 用户自助修改密码页面 |

---

## docker-compose 配置部署

将以下内容保存为 `docker-compose.yml` 文件：

```yaml
version: '3.8'
services:
  openldap:
    image: osixia/openldap:1.5.0
    container_name: openldap
    privileged: true
    restart: always
    environment:
      - TZ=Asia/Shanghai
      - LDAP_DOMAIN=demo.com
      - LDAP_ADMIN_PASSWORD=123456
    ports:
      - 389:389
      - 636:636
    volumes:
      - ./data/openldap/slapd:/etc/ldap/slapd.d
      - ./data/openldap/data:/var/lib/ldap

  phpldapadmin:
    image: osixia/phpldapadmin:0.9.0
    container_name: phpldapadmin
    privileged: true
    restart: always
    environment:
      - PHPLDAPADMIN_LDAP_HOSTS=openldap
      - PHPLDAPADMIN_HTTPS=false
    depends_on:
      - openldap
    ports:
      - 8081:80
    volumes:
      - ./data/phpldapadmin:/var/www/phpldapadmin

  self-service-password:
    image: tiredofit/self-service-password:5.3.1
    container_name: ldap-password
    restart: always
    depends_on:
      - openldap
    ports:
      - 8080:80
    environment:
      - LDAP_SERVER=ldap://openldap
      - LDAP_BINDDN=cn=admin,dc=demo,dc=com
      - LDAP_BINDPASS=123456
      - LDAP_BASE_SEARCH=dc=demo,dc=com
    volumes:
      - ./data/ldap-password/ssp:/www/ssp
      - ./data/ldap-password/logs:/www/logs
